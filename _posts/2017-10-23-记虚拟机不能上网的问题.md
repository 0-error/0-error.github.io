---
layout: post
title: 记虚拟机不能上网的问题
categories: 17th
description: 虚拟机上网
keywords: 虚拟机

---

虚拟机上网问题一直迷迷糊糊，以前碰巧设置好能联网了倒也得过且过，现在虚拟机桥接模式死活连不上网，才知道自己一直没有弄明白这个问题。所以这里mark一下，怕是过了今晚再没有写的欲望。

##上网的基础

   能上网的时候感觉理所应当，死活上不去了是不是该思考下这个问题。
   首先，网络数据要传出或者传进，得知道你是谁吧，传给谁吧，网络靠什么表明身份，IP和Mac，Mac呢，出厂的时候固定好了，不需要你配置了，但是IP得配置吧。
所以首先你得有个IP，按理说呢要上网每个人都需要配置IP，但是人类追求懒的天性不会允许这样的事情，DHCP可以自动配置IP，DNS服务器，网关也都可以自动获取到。
  但是自动获取并不是万能的，有时候会出错，所以呢，连不上网的时候看一下是不是这些配置错了。当然，不同的错误现象也是不一样的，不一一解释了。
所以呢，连不上网，思路是这样的，ping下自己，能通，说明机内路是通的，本机设备没问题，再ping一下局域网内机，通说明局域网没问题，不通ping一下网关，网关也通，在网关配置正确的情况下上不了网那应该是网关的问题。再ping外网，ping百度IP能通，ping域名不能通，那就是dns的问题了。
 但是，在虚拟机内，情况就复杂些了，因为虚拟机不同的连接模式，对应的网络连接情况不一样。

##虚拟机三种模式
   NAT模式，家用路由器是这种模式，新建一个子网络，子网通过NAT设备（家用路由）转换网络地址上外网，所以这个模式下，虚拟机的网络是主机的子网络，主机相当于网关，虚拟机的网络和主机网络不在一个IP段内。网络拓扑图：
![](http://upload-images.jianshu.io/upload_images/2360187-40fd995ee83ab8a3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
值得注意的是，虚拟机的网络能够通过主机上外网，但是不能与主机所在的局域网内其他主机通信，因为主机只是具备NAT功能但是并没有路由转发的功能。
    桥接模式，虚拟机网络和主机网络接在了一个虚拟的网桥上，如图：
![](http://upload-images.jianshu.io/upload_images/2360187-ee6ee83fdf6a0454.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)所以虚拟机和主机是在同一个网络下。
   主机模式，Host-Only模式其实就是NAT模式去除了虚拟NAT设备，然后使用VMware Network Adapter VMnet1虚拟网卡连接VMnet1虚拟交换机来与虚拟机通信的，Host-Only模式将虚拟机与外网隔开，使得虚拟机成为一个独立的系统，只与主机相互通讯，如图：
![](http://upload-images.jianshu.io/upload_images/2360187-66903ad5a4786b93.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

##我的问题
所以照之前所说，NAT模式和桥接模式都是可以连上外网的，我的虚拟机在NAT模式下可以上网，但是我需要虚拟机能与主机局域网内的其他主机通信，所以我选择桥接模式，但是却不能上网，只能Ping通主机和本虚拟机，检查了无数遍的IP配置，DNS配置，网关设置，虚拟机桥接设置，完全正确，但就是不能上网。
直到我试了有线，能联网，才发现原来是无线网卡桥接的问题，有可能是咱学校的无线网是拨号上网。




参考：
[文章1](http://www.cnblogs.com/playerboy/p/3153021.html)
[文章2](http://www.linuxidc.com/Linux/2016-09/135521.htm)