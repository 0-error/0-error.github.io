---
layout: post
title: web 自动化框架总结
categories: 18th
description: 自动化
keywords: 自动化

---

##目的

实现太平洋系统的弹屏功能和创建工单功能的web自动化测试，以及页面显示是否正确的校验。

##过程

在config.json文件下配置页面元素，以控制台形式运行主程序，结果以输出和html报告文件形式展现出来。

##重点问题

1. 交互逻辑问题
因为在每次打开平台页面都会进入坐席选择页面，并且有存在登录的需求，而且还有存在重新登录的可能，所以需要实现登录功能，并且需要一套交互逻辑，即若存在登录页面则登录，且需要判断是否存在重新登录页面，若不存在则直接进入坐席选择页面，整个逻辑以try,except,else,finally等异常捕获等方式实现。
![image.png](https://upload-images.jianshu.io/upload_images/2360187-68b031a239cff9f1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

2. 元素定位问题
主要两个问题，一是如何定位，通常有通过id，name，classname等来进行唯一元素定位，但是这些元素很多情况下不存在或者存在重复情况，所以实际操作过程中觉得xpath定位最好用，可以参考[xpath语法](http://www.w3school.com.cn/xpath/xpath_syntax.asp)
但是需要注意的是由于页面是在不断变化的，使用xpath绝对路径会存在找不到元素的情况，所以建议使用xpath相对路径结合xpath语法，几乎可以精准定位到页面中任何元素。
第二个问题是页面的变化会导致需要定位的元素不可见，导致定位不到，比如弹屏下拉菜单会遮挡确定按钮；点击订单后信息会不在当前页面内。解决的方法是模拟人的操作，比方说弹屏遮挡就先点击其他位置让确定按钮显示，订单信息不可见就先滚动页面让信息快速加载出来。参考[页面元素无法点击](https://blog.csdn.net/sinat_29673403/article/details/78459648)
第三个问题是页面加载速度没有代码执行速度快，导致定位不到，所以需要设置等待时间直到找到元素。

3. 结果显示问题，这里添加了额外的python包HTMLTestRunner，采用html的方式显示testcase的运行结果，在有许多test case时还是挺有用的，但是不能显示一个test case内的运行细节，所以细节运行情况用控制台输出的方式展现。

##优化

1. 代码上的优化
为了避免书写大量重复代码以及代码的可读性。将主要逻辑抽象成多个类，主类展示交互逻辑，page文件存放各个不同页面的抽象类，tool文件存放常用的方法抽象类，jsonread文件存放读取json文件的方法类。

2. 行为上的优化
加入了json配置文件使得页面元素信息可配，而不用直接在代码中更改；添加了结果展示，使得结果直观。

3. 速度上的优化
加入了多进程，可以实现同一时刻同时测多个用例。

##后续问题

1. 逻辑问题
操作逻辑还有一定的问题，比如判断是否存在登录页面时，失败了不一定是不存在登录页面，还有可能是没有加载出来（虽然可能性小），但如果代码判断是不存在登录页面而实际是存在只是没有加载出来的话，那后续就会报错。

2. 更好用的问题，虽然配置了json来实现配置文件填写，但是如果要测别的功能等话，还是需要在代码内添加别的功能代码，人的操作是千变万化的，反映到代码中就是无数的代码量，如何使代码统一和可配，能减少代码量。可以根据测试用例逻辑来编写相应代码，我觉得这种web自动化的测试更适合于重复操作量大且人实施起来困难的操作。

3. 多进程的问题。虽然实现了多进程，但是实际的问题还是有的，比如将多进程的测试报告写在一个结果报告中，需要加锁读写，后续可能再完善下。

##参考：

书《SELENIUM+2+自动化测试实战++基于PYTHON语言》
[selenium中文文档](https://selenium-python-zh.readthedocs.io/en/latest/installation.html#id2)
[json语法](https://www.jianshu.com/writer#/notebooks/4872646/notes/32636124/preview)
[UnicodeDecodeError](https://www.cnblogs.com/VseYoung/p/htmlrestrunner.html)
